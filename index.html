import React, { useState } from 'react';
import { Heart, TrendingUp, Users, AlertTriangle, CheckCircle, XCircle, BarChart3, DollarSign, Clock, Shield, ArrowRight, RefreshCw, Award } from 'lucide-react';

export default function CancerInsuranceLearning() {
  const [step, setStep] = useState(0); // í˜„ì¬ í•™ìŠµ ë‹¨ê³„ (0: ì‹œì‘, 1: ì˜ˆì¸¡, 2: ì •ë‹µ, 3: ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ, 4: ì‹œë‚˜ë¦¬ì˜¤ ì§„í–‰, 5: ì „ì²´ ë¹„êµ, 6: ë¡¤í”Œë ˆì´, 7: ì™„ë£Œ)
  const [userPrediction, setUserPrediction] = useState(50); // ì‚¬ìš©ìì˜ ì˜ˆì¸¡ê°’ (100ëª… ì¤‘ ëª‡ ëª…)
  const [selectedScenario, setSelectedScenario] = useState(null); // ì„ íƒëœ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°
  const [scenarioProgress, setScenarioProgress] = useState(0); // ì‹œë‚˜ë¦¬ì˜¤ ì§„í–‰ë„ (ì¹˜ë£Œ ë‹¨ê³„)
  const [consultingAnswer, setConsultingAnswer] = useState(null); // ë¡¤í”Œë ˆì´ ì„ íƒ ë‹µë³€ ì¸ë±ìŠ¤

  [cite_start]// ë¬¸ì„œì—ì„œ ì¶”ì¶œí•œ 4ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° [cite: 59, 65, 76, 89]
  const scenarios = [
    {
      id: 1,
      name: "ë‹¨ì¼ ì¹˜ë£Œ",
      patient: "ìœ„ì•” 1ê¸° í™˜ì",
      percent: 21,
      color: "green",
      treatments: [
        { name: "ì•” ì§„ë‹¨ (ì§„ë‹¨ê¸ˆ 1íšŒ ì§€ê¸‰)", diagnosis: 2000, treatment: 0 },
        { name: "ë‚´ì‹œê²½ ìˆ˜ìˆ  1íšŒ (ì¹˜ë£Œë¹„ 1íšŒ ì§€ê¸‰)", diagnosis: 0, treatment: 1000 }
      ],
      total: { diagnosis: 2000, treatment: 1000 },
      icon: CheckCircle
    },
    {
      id: 2,
      name: "ë³µí•© ì¹˜ë£Œ",
      patient: "ìœ ë°©ì•” 2ê¸°, 48ì„¸ ì—¬ì„±",
      percent: 55,
      color: "blue",
      treatments: [
        { name: "ì•” ì§„ë‹¨ (ì§„ë‹¨ê¸ˆ 1íšŒ ì§€ê¸‰)", diagnosis: 2000, treatment: 0 },
        { name: "ì„ í–‰í•­ì•”í™”í•™ìš”ë²• (1ì°¨ ì¹˜ë£Œë¹„)", diagnosis: 0, treatment: 1000 },
        { name: "ìœ ë°©ì ˆì œìˆ  (2ì°¨ ì¹˜ë£Œë¹„)", diagnosis: 0, treatment: 1000 },
        { name: "ë³´ì¡°í•­ì•”í™”í•™ìš”ë²• (3ì°¨ ì¹˜ë£Œë¹„)", diagnosis: 0, treatment: 1000 },
        { name: "í‘œì í•­ì•”ì œ í—ˆì…‰í‹´ (4ì°¨ ì¹˜ë£Œë¹„)", diagnosis: 0, treatment: 1000 },
        { name: "ë°©ì‚¬ì„  ì¹˜ë£Œ (5ì°¨ ì¹˜ë£Œë¹„)", diagnosis: 0, treatment: 1000 }
      ],
      total: { diagnosis: 2000, treatment: 5000 }, // ì´ 5íšŒ ì¹˜ë£Œ ì§€ê¸‰ì•¡ + ì§„ë‹¨ê¸ˆ
      icon: TrendingUp
    },
    {
      id: 3,
      name: "ì¥ê¸° ì¹˜ë£Œ",
      patient: "íì•” 3ê¸° í™˜ì",
      percent: 15,
      color: "orange",
      treatments: [
        { name: "ì•” ì§„ë‹¨ (ì§„ë‹¨ê¸ˆ 1íšŒ ì§€ê¸‰)", diagnosis: 2000, treatment: 0 },
        { name: "ë™ì‹œí•­ì•”ë°©ì‚¬ì„ ì¹˜ë£Œ (1ë…„ì°¨, 1íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "ê³µê³ í•­ì•”í™”í•™ìš”ë²• (1ë…„ì°¨, 2íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "1ì„¸ëŒ€ í‘œì í•­ì•”ì œ íˆ¬ì—¬ (2ë…„ì°¨, 3íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "3ì„¸ëŒ€ í‘œì í•­ì•”ì œ ë³€ê²½ (2ë…„ì°¨, 4íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "ë©´ì—­í•­ì•”ì œ ì¶”ê°€ (3ë…„ì°¨, 5íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "ë‡Œ ì „ì´, ì •ìœ„ë°©ì‚¬ì„ ìˆ˜ìˆ  (3ë…„ì°¨, 6íšŒ)", diagnosis: 0, treatment: 1000 }
      ],
      total: { diagnosis: 2000, treatment: 6000 }, // ì´ 6íšŒ ì¹˜ë£Œ ì§€ê¸‰ì•¡ + ì§„ë‹¨ê¸ˆ
      icon: Clock
    },
    {
      id: 4,
      name: "ì¬ë°œÂ·ì „ì´",
      patient: "ë‚œì†Œì•” 3ê¸° ì¬ë°œ í™˜ì",
      percent: 9, // (ì‹¤ì œ ì¬ë°œ/ì „ì´ í™˜ì ë¹„ìœ¨)
      color: "red",
      treatments: [
        { name: "ì´ˆê¸° ì§„ë‹¨ (ì§„ë‹¨ê¸ˆ 1íšŒ ì§€ê¸‰)", diagnosis: 2000, treatment: 0 },
        { name: "ì¢…ì–‘ê°ì¶•ìˆ  (ì´ˆê¸° ì¹˜ë£Œ 1íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "ì¤‘í™˜ìì‹¤ ì…ì› (ì´ˆê¸° ì¹˜ë£Œ 2íšŒ, 500ë§Œì›)", diagnosis: 0, treatment: 500 },
        { name: "ë³´ì¡°í•­ì•”í™”í•™ìš”ë²• (ì´ˆê¸° ì¹˜ë£Œ 3íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "ìœ ì§€í•­ì•”í™”í•™ìš”ë²• (ì´ˆê¸° ì¹˜ë£Œ 4íšŒ)", diagnosis: 0, treatment: 1000 }, // ì´ˆê¸° ì¹˜ë£Œ 4íšŒ(3500ë§Œì›)
        [cite_start]{ name: "ì¬ë°œ - 2ì°¨ í•­ì•”í™”í•™ìš”ë²• (ì¬ë°œ ì¹˜ë£Œ 5íšŒ)", diagnosis: 0, treatment: 1000 }, // ì§„ë‹¨ê¸ˆì€ ì—¬ê¸°ì„œ 0ì› [cite: 113]
        { name: "ë³µìˆ˜ ì²œì ë° ì…ì› (ì¬ë°œ ì¹˜ë£Œ 6íšŒ, 500ë§Œì›)", diagnosis: 0, treatment: 500 },
        { name: "3ì°¨ í•­ì•”í™”í•™ìš”ë²• (ì¬ë°œ ì¹˜ë£Œ 7íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "í‘œì í•­ì•”ì œ ë³‘í–‰ (ì¬ë°œ ì¹˜ë£Œ 8íšŒ)", diagnosis: 0, treatment: 1000 },
        { name: "í†µì¦/ë³µìˆ˜ ê´€ë¦¬ ì…ì› (ì¬ë°œ ì¹˜ë£Œ 9íšŒ, 500ë§Œì›)", diagnosis: 0, treatment: 500 }
      ],
      total: { diagnosis: 2000, treatment: 7500 }, // ì´ 7.5íšŒ ì¹˜ë£Œ ì§€ê¸‰ì•¡ + ì§„ë‹¨ê¸ˆ
      icon: AlertTriangle
    }
  ];

  [cite_start]// ë¬¸ì„œ ê¸°ë°˜ ê³ ê° ìƒë‹´ ì§ˆë¬¸ ë° ë‹µë³€ ë°ì´í„° [cite: 5, 6, 120]
  const consultingQuestions = [
    {
      question: "ì•” ì§„ë‹¨ ì‹œ ëª©ëˆ 2,000ë§Œì›ì„ í•œ ë²ˆì— ë°›ëŠ” 'ì§„ë‹¨ê¸ˆ'ì´ ë‚˜ì„ê¹Œìš”, ì•„ë‹ˆë©´ ì¹˜ë£Œë°›ì„ ë•Œë§ˆë‹¤ ê³„ì† ë³´ì¥ë°›ëŠ” 'ì¹˜ë£Œë¹„'ê°€ ë‚˜ì„ê¹Œìš”?",
      answers: [
        {
          text: "ë„¤, ëª©ëˆì´ ì¢‹ì£ . ë‹¨ì¼ ì¹˜ë£Œë¡œ ëë‚˜ë©´ ì§„ë‹¨ê¸ˆì´ 1,000ë§Œì› ë” ìœ ë¦¬í•©ë‹ˆë‹¤. ì§„ë‹¨ê¸ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤.",
          score: 10, // 21%ì˜ í–‰ìš´ì—ë§Œ ê¸°ëŒ€ëŠ” ë‹µë³€
          feedback: "âŒ 21%ì˜ í–‰ìš´ì—ë§Œ ë² íŒ…í•˜ëŠ” ìœ„í—˜í•œ ë‹µë³€ì…ë‹ˆë‹¤. 79%ì˜ í™˜ìì—ê²ŒëŠ” ë§¤ìš° ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        },
        {
          text: "í†µê³„ë¥¼ ë³´ì‹œë©´, ì•” í™˜ì 100ëª… ì¤‘ 79ëª…ì€ ì—¬ëŸ¬ ì¹˜ë£Œë¥¼ ë°›ìŠµë‹ˆë‹¤. 2,000ë§Œì›ìœ¼ë¡œëŠ” ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          score: 50, // í†µê³„ë§Œ ì–¸ê¸‰í•œ ë‹µë³€
          feedback: "âš ï¸ ì¢‹ì€ ì‹œì‘ì´ì§€ë§Œ, ì§„ë‹¨ê¸ˆ ìƒí’ˆì˜ ê²°ì •ì  ì•½ì ì¸ 'ì¬ë°œ ì‹œ 0ì›'ì´ë¼ëŠ” ë¦¬ìŠ¤í¬ë¥¼ ë” ê°•ì¡°í•´ì•¼ í•©ë‹ˆë‹¤."
        },
        {
          text: "ì¤‘ìš”í•œ ì§ˆë¬¸ì´ì„¸ìš”. ëŒ€ë‹¤ìˆ˜(79%)ëŠ” ë³µí•© ì¹˜ë£Œë¥¼ ë°›ìœ¼ë©° í‰ê·  2.27ë°° ë” ë§ì€ ë¹„ìš©ì´ ë“­ë‹ˆë‹¤. ê²°ì •ì ìœ¼ë¡œ, ì¬ë°œ ì‹œ ì§„ë‹¨ê¸ˆì€ ì¶”ê°€ ì§€ê¸‰ì´ 0ì›ì´ì§€ë§Œ ì¹˜ë£Œë¹„ëŠ” ê³„ì† ë³´ì¥ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          [cite_start]score: 100, // í™•ë¥ , í‰ê·  ì§€ê¸‰ì•¡, ì¬ë°œ ë¦¬ìŠ¤í¬ë¥¼ ëª¨ë‘ ì„¤ëª…í•œ ë‹µë³€ [cite: 197, 200]
          feedback: "âœ… ì™„ë²½í•©ë‹ˆë‹¤! í™•ë¥ , í‰ê·  ì§€ê¸‰ì•¡, ì¬ë°œ ë¦¬ìŠ¤í¬ë¥¼ ëª¨ë‘ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ê³ ê°ì˜ ê°€ì¥ í° ê±±ì •ì„ í•´ì†Œí•˜ëŠ” ìµœì ì˜ ì„¤ë“ì…ë‹ˆë‹¤."
        }
      ]
    }
  ];

  // 1. ì‹œì‘ í™”ë©´
  const renderStep0 = () => (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
      <div className="max-w-4xl w-full bg-white rounded-3xl shadow-2xl p-12 text-center">
        <Heart className="w-20 h-20 mx-auto mb-6 text-red-500 animate-pulse" />
        <h1 className="text-5xl font-bold mb-4 text-gray-800">FP ì•”ë³´í—˜ ë§ˆìŠ¤í„°</h1>
        <p className="text-2xl text-gray-600 mb-8">79%ì˜ í˜„ì‹¤ ì„¤ë“ ì „ëµ</p>
        <div className="bg-blue-50 rounded-xl p-6 mb-8 border-l-4 border-blue-400">
          <p className="text-xl text-gray-700">
            <strong>í•µì‹¬ ì§ˆë¬¸:</strong> ì•” ì§„ë‹¨ê¸ˆ vs ì¹˜ë£Œë¹„, ê³ ê°ì—ê²Œ ê°€ì¥ ìœ ë¦¬í•œ ì„ íƒì€?
          </p>
        </div>
        <button
          onClick={() => setStep(1)}
          className="bg-blue-600 hover:bg-blue-700 text-white px-12 py-4 rounded-full text-xl font-semibold transition-all transform hover:scale-105 shadow-lg w-full md:w-auto"
        >
          í•™ìŠµ ì‹œì‘í•˜ê¸° (FP í›ˆë ¨) <ArrowRight className="inline ml-2" />
        </button>
      </div>
    </div>
  );

  // 2. í™•ë¥  ì˜ˆì¸¡ ê²Œì„
  const renderStep1 = () => (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-pink-100 flex items-center justify-center p-4">
      <div className="max-w-4xl w-full bg-white rounded-3xl shadow-2xl p-12">
        <Users className="w-16 h-16 mx-auto mb-6 text-purple-600" />
        <h2 className="text-4xl font-bold mb-6 text-center text-gray-800">1ë‹¨ê³„: í™•ë¥  ì˜ˆì¸¡ ê²Œì„</h2>
        <div className="bg-purple-50 rounded-xl p-8 mb-8">
          <p className="text-2xl text-center mb-8 text-gray-700">
            [cite_start]<strong>ì§ˆë¬¸:</strong> ì•” í™˜ì 100ëª… ì¤‘ <span className="text-purple-600 font-bold">ë‹¨ í•œ ë²ˆì˜ ì¹˜ë£Œ</span>ë¡œ ëë‚˜ëŠ” ì‚¬ëŒì€ ëª‡ ëª…ì¼ê¹Œìš”? [cite: 10]
          </p>
          <div className="mb-8">
            <div className="text-center mb-4">
              <p className="text-3xl font-bold text-purple-600 animate-bounce">{userPrediction}ëª…</p>
            </div>
            <div className="relative p-4 bg-white rounded-xl shadow-lg border-2 border-purple-300">
              <input
                type="range"
                min="0"
                max="100"
                value={userPrediction}
                onChange={(e) => setUserPrediction(Number(e.target.value))}
                className="w-full h-4 bg-purple-200 rounded-lg appearance-none cursor-pointer hover:bg-purple-300 transition-all"
                style={{
                  background: `linear-gradient(to right, #9333ea 0%, #9333ea ${userPrediction}%, #e9d5ff ${userPrediction}%, #e9d5ff 100%)`
                }}
              />
            </div>
            <div className="flex justify-between mt-2 text-base font-semibold text-gray-600">
              <span>0ëª…</span>
              <span>100ëª…</span>
            </div>
          </div>

          <div className="grid grid-cols-10 gap-1 mb-8">
            {[...Array(100)].map((_, i) => (
              <div
                key={i}
                className={`w-full aspect-square rounded ${i < userPrediction ? 'bg-purple-500' : 'bg-gray-200'} transition-all`}
              />
            ))}
          </div>
        </div>

        <button
          onClick={() => setStep(2)}
          className="w-full bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 rounded-full text-xl font-semibold transition-all transform hover:scale-105 shadow-lg"
        >
          ì •ë‹µ í™•ì¸ ë° '21%ì˜ í•¨ì •' í™•ì¸í•˜ê¸°
        </button>
      </div>
    </div>
  );

  // 3. ì •ë‹µ í™•ì¸ ë° í†µê³„ ë¶„ì„
  const renderStep2 = () => {
    const correctAnswer = 21; [cite_start]// ì‹¤ì œ ë‹¨ì¼ ì¹˜ë£Œ í™˜ì ìˆ˜ [cite: 12]
    const difference = Math.abs(userPrediction - correctAnswer);
    const resultMessage = difference === 0 ? "ë†€ëìŠµë‹ˆë‹¤! ì •í™•íˆ ë§ì¶”ì…¨ì–´ìš”!" : difference <= 10 ? "ë§¤ìš° ê·¼ì ‘í–ˆìŠµë‹ˆë‹¤! í˜„ì‹¤ì„ ì˜ ì•Œê³  ê³„ì‹œë„¤ìš”." : "ëŒ€ë¶€ë¶„ì´ ì˜ˆìƒë³´ë‹¤ í›¨ì”¬ ì ìŠµë‹ˆë‹¤. í†µê³„ê°€ ì•”ë³´í—˜ ì„ íƒì˜ ê¸°ì¤€ì„ ë§í•´ì¤ë‹ˆë‹¤.";

    return (
      <div className="min-h-screen bg-gradient-to-br from-red-50 to-orange-100 flex items-center justify-center p-4">
        <div className="max-w-4xl w-full bg-white rounded-3xl shadow-2xl p-12">
          <AlertTriangle className="w-16 h-16 mx-auto mb-6 text-orange-600" />
          <h2 className="text-4xl font-bold mb-6 text-center text-gray-800">2ë‹¨ê³„: ì¶©ê²©ì ì¸ í˜„ì‹¤! 21%ì˜ í•¨ì •</h2>

          <div className="text-center mb-8">
            <p className="text-xl text-gray-600 mb-2">ë‹¹ì‹ ì˜ ì˜ˆì¸¡: <strong className="text-3xl text-purple-600">{userPrediction}ëª…</strong></p>
            [cite_start]<p className="text-xl text-gray-600 mb-4">ì‹¤ì œ ì •ë‹µ: <strong className="text-5xl font-bold text-red-600">ë‹¨ 21ëª…!</strong> [cite: 12]</p>
            <p className="text-xl font-semibold text-orange-600">{resultMessage}</p>
          </div>

          <div className="grid grid-cols-2 gap-6 mb-8">
            <div className="bg-green-50 rounded-xl p-6 border-2 border-green-300">
              <CheckCircle className="w-12 h-12 text-green-600 mb-3" />
              <h3 className="text-2xl font-bold text-green-700 mb-2">21%</h3>
              <p className="text-base text-gray-700">ë‹¨ì¼ ì¹˜ë£Œë¡œ ëë‚˜ëŠ” **ìš´ ì¢‹ì€ ê²½ìš°**</p>
            </div>
            <div className="bg-red-50 rounded-xl p-6 border-2 border-red-300">
              <XCircle className="w-12 h-12 text-red-600 mb-3" />
              <h3 className="text-2xl font-bold text-red-700 mb-2">79%</h3>
              [cite_start]<p className="text-base text-gray-700">ì—¬ëŸ¬ ì¹˜ë£Œë¥¼ ê²½í—˜í•˜ëŠ” **ëŒ€ë‹¤ìˆ˜** [cite: 14]</p>
            </div>
          </div>

          <div className="bg-yellow-50 rounded-xl p-6 mb-8 border-l-4 border-yellow-400">
            <p className="text-lg text-gray-700">
              [cite_start]ì•”ë³´í—˜ ì„ íƒì€ **'ë‚´ê°€ 21%ì— ì†í•  ê²ƒì¸ê°€, ì•„ë‹ˆë©´ 79%ì— ì†í•  ê²ƒì¸ê°€'**ì— ëŒ€í•œ í™•ë¥  ê²Œì„ì…ë‹ˆë‹¤. [cite: 30]
            </p>
          </div>

          <button
            onClick={() => setStep(3)}
            className="w-full bg-orange-600 hover:bg-orange-700 text-white px-8 py-4 rounded-full text-xl font-semibold transition-all transform hover:scale-105 shadow-lg"
          >
            79%ì˜ í˜„ì‹¤, ì‹œë‚˜ë¦¬ì˜¤ë³„ ë¹„êµ ì²´í—˜í•˜ê¸° <ArrowRight className="inline ml-2" />
          </button>
        </div>
      </div>
    );
  };

  // 4. ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ í™”ë©´
  const renderStep3 = () => (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-cyan-100 p-4">
      <div className="max-w-6xl mx-auto py-12">
        <div className="bg-white rounded-3xl shadow-2xl p-12">
          <BarChart3 className="w-16 h-16 mx-auto mb-6 text-blue-600" />
          <h2 className="text-4xl font-bold mb-8 text-center text-gray-800">3ë‹¨ê³„: 4ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ ì²´í—˜</h2>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {scenarios.map((scenario) => {
              const Icon = scenario.icon;
              const colors = {
                green: 'bg-green-50 border-green-300 hover:bg-green-100 text-green-700',
                blue: 'bg-blue-50 border-blue-300 hover:bg-blue-100 text-blue-700',
                orange: 'bg-orange-50 border-orange-300 hover:bg-orange-100 text-orange-700',
                red: 'bg-red-50 border-red-300 hover:bg-red-100 text-red-700'
              };

              return (
                <button
                  key={scenario.id}
                  onClick={() => {
                    setSelectedScenario(scenario);
                    setScenarioProgress(0);
                    setStep(4);
                  }}
                  className={`${colors[scenario.color]} rounded-xl p-6 border-2 transition-all transform hover:scale-105 text-left`}
                >
                  <Icon className={`w-12 h-12 mb-4 ${scenario.color === 'green' ? 'text-green-600' : scenario.color === 'blue' ? 'text-blue-600' : scenario.color === 'orange' ? 'text-orange-600' : 'text-red-600'}`} />
                  <h3 className="text-2xl font-bold mb-2">{scenario.name} ({scenario.percent}%)</h3>
                  <p className="text-base text-gray-600 mb-4">{scenario.patient}</p>
                  <div className="flex justify-between items-center text-sm font-semibold">
                    <span>ì§„ë‹¨ê¸ˆ vs ì¹˜ë£Œë¹„ ê¸ˆì•¡ ë¹„êµ ì‹œì‘</span>
                    <ArrowRight className="w-6 h-6" />
                  </div>
                </button>
              );
            })}
          </div>
        </div>
      </div>
    </div>
  );

  // 5. ì‹œë‚˜ë¦¬ì˜¤ ì§„í–‰ í™”ë©´
  const renderStep4 = () => {
    if (!selectedScenario) return null;

    const currentTreatment = selectedScenario.treatments[scenarioProgress];
    [cite_start]// ëˆ„ì  ì§€ê¸‰ì•¡ ê³„ì‚° [cite: 116, 117]
    const diagnosisTotal = selectedScenario.treatments.slice(0, scenarioProgress + 1).reduce((sum, t) => sum + t.diagnosis, 0);
    const treatmentTotal = selectedScenario.treatments.slice(0, scenarioProgress + 1).reduce((sum, t) => sum + t.treatment, 0);

    const isComplete = scenarioProgress >= selectedScenario.treatments.length - 1;

    [cite_start]// ì§„ë‹¨ê¸ˆ ìƒí’ˆì˜ ê²½ìš°, ì²« ë²ˆì§¸ 'ì•” ì§„ë‹¨' í•­ëª© ì´í›„ì—ëŠ” 0ì› ì§€ê¸‰ [cite: 113]
    const currentDiagnosisPayment = currentTreatment.diagnosis > 0 ? currentTreatment.diagnosis : 0;
    [cite_start]// ì¹˜ë£Œë¹„ ìƒí’ˆì€ ë§¤ ì¹˜ë£Œ í–‰ìœ„ë§ˆë‹¤ ì§€ê¸‰ [cite: 114]
    const currentTreatmentPayment = currentTreatment.treatment;

    const comparisonMessage =
      isComplete
        ? treatmentTotal > diagnosisTotal
          ? `ì¹˜ë£Œë¹„ê°€ ${(treatmentTotal - diagnosisTotal).toLocaleString()}ë§Œì› ë” ìœ ë¦¬í•©ë‹ˆë‹¤! (ì•½ ${(treatmentTotal / diagnosisTotal).toFixed(2)}ë°°)`
          : `ì§„ë‹¨ê¸ˆì´ ${(diagnosisTotal - treatmentTotal).toLocaleString()}ë§Œì› ë” ìœ ë¦¬í•©ë‹ˆë‹¤.`
        : "ë‹¤ìŒ ì¹˜ë£Œ ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ë©° ëˆ„ì  ìˆ˜ë ¹ì•¡ì„ ë¹„êµí•´ë³´ì„¸ìš”.";

    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 p-4">
        <div className="max-w-5xl mx-auto py-12">
          <div className="bg-white rounded-3xl shadow-2xl p-12">
            <div className="mb-8">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-3xl font-bold text-gray-800">{selectedScenario.name} ì‹œë‚˜ë¦¬ì˜¤</h2>
                <span className="text-xl text-gray-600">{selectedScenario.patient}</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-3">
                <div
                  className="bg-blue-600 h-3 rounded-full transition-all duration-500"
                  style={{ width: `${((scenarioProgress + 1) / selectedScenario.treatments.length) * 100}%` }}
                />
              </div>
              <p className="text-sm text-gray-600 mt-2 text-center">
                ì¹˜ë£Œ ë‹¨ê³„ {scenarioProgress + 1} / {selectedScenario.treatments.length}
              </p>
            </div>

            <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-8 mb-8">
              <h3 className="text-2xl font-bold mb-6 text-center">{currentTreatment.name} ë‹¨ê³„</h3>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="bg-red-50 rounded-xl p-6 border-2 border-red-200 text-center">
                  <DollarSign className="w-8 h-8 text-red-600 mx-auto mb-3" />
                  [cite_start]<h4 className="text-xl font-bold text-red-700">ì§„ë‹¨ê¸ˆ ìƒí’ˆ (2,000ë§Œì›) [cite: 5, 56]</h4>
                  <p className="text-4xl font-bold text-red-600 mt-3">{diagnosisTotal.toLocaleString()}ë§Œì›</p>
                  <p className="text-sm text-gray-600 mt-1">
                    (ì´ë²ˆ ë‹¨ê³„ ì§€ê¸‰ì•¡: {currentDiagnosisPayment > 0 ? `${currentDiagnosisPayment.toLocaleString()[cite_start]}ë§Œì›` : '0ì› [cite: 113]'})
                  </p>
                </div>

                <div className="bg-blue-50 rounded-xl p-6 border-2 border-blue-200 text-center">
                  <Shield className="w-8 h-8 text-blue-600 mx-auto mb-3" />
                  [cite_start]<h4 className="text-xl font-bold text-blue-700">ì¹˜ë£Œë¹„ ìƒí’ˆ (í•­ëª©ë‹¹ 1,000ë§Œì› ê°€ì •) [cite: 56]</h4>
                  <p className="text-4xl font-bold text-blue-600 mt-3">{treatmentTotal.toLocaleString()}ë§Œì›</p>
                  <p className="text-sm text-gray-600 mt-1">
                    (ì´ë²ˆ ë‹¨ê³„ ì§€ê¸‰ì•¡: +{currentTreatmentPayment.toLocaleString()[cite_start]}ë§Œì› [cite: 114])
                  </p>
                </div>
              </div>
            </div>

            {isComplete && (
              <div className="bg-yellow-100 rounded-xl p-6 mb-8 border-l-4 border-yellow-500 text-center">
                <h4 className="text-2xl font-bold mb-3">ìµœì¢… ì‹œë‚˜ë¦¬ì˜¤ ê²°ê³¼</h4>
                <p className="text-xl font-semibold text-orange-600">{comparisonMessage}</p>
              </div>
            )}

            <div className="flex gap-4">
              <button
                onClick={() => setStep(3)}
                className="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-8 py-4 rounded-full text-xl font-semibold transition-all"
              >
                ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ ë³´ê¸°
              </button>
              {!isComplete && (
                <button
                  onClick={() => setScenarioProgress(scenarioProgress + 1)}
                  className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-full text-xl font-semibold transition-all transform hover:scale-105 shadow-lg"
                >
                  ë‹¤ìŒ ì¹˜ë£Œ ë‹¨ê³„ <ArrowRight className="inline ml-2" />
                </button>
              )}
              {isComplete && (
                <button
                  onClick={() => setStep(5)}
                  className="flex-1 bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-full text-xl font-semibold transition-all transform hover:scale-105 shadow-lg"
                >
                  4ë‹¨ê³„: ì „ì²´ ë¹„êµ ë¶„ì„ ë° ìµœì¢… ê²°ë¡  ë³´ê¸°
                </button>
              )}
            </div>
          </div>
        </div>
      </div>
    );
  };

  // 6. ì „ì²´ ë¹„êµ ë° ê²°ë¡ 
  const renderStep5 = () => {
    const avgDiagnosis = 2000; [cite_start]// ì§„ë‹¨ê¸ˆ ìƒí’ˆ í‰ê·  ìˆ˜ë ¹ì•¡ [cite: 150]
    const avgTreatment = 4535; [cite_start]// ì¹˜ë£Œë¹„ ìƒí’ˆ í‰ê·  ìˆ˜ë ¹ì•¡ (4,535ë§Œì›) [cite: 157]
    const differenceRatio = (avgTreatment / avgDiagnosis).toFixed(2); [cite_start]// 2.27ë°° [cite: 159]

    return (
      <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4">
        <div className="max-w-6xl mx-auto py-12">
          <div className="bg-white rounded-3xl shadow-2xl p-12">
            <Award className="w-16 h-16 mx-auto mb-6 text-green-600" />
            <h2 className="text-4xl font-bold mb-8 text-center text-gray-800">4ë‹¨ê³„: ì „ì²´ ë¹„êµ ë¶„ì„ ë° ìµœì¢… ê²°ë¡ </h2>

            {/* í‰ê·  ìˆ˜ë ¹ì•¡ ë¹„êµ */}
            <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-8 mb-8">
              [cite_start]<h3 className="text-2xl font-bold mb-6 text-center text-blue-800">í‰ê·  ìˆ˜ë ¹ì•¡, {differenceRatio}ë°°ì˜ ì°¨ì´ [cite: 159]</h3>
              <div className="grid grid-cols-2 gap-8 mb-6">
                <div className="text-center">
                  <p className="text-base text-gray-600 mb-2">ì§„ë‹¨ê¸ˆ í‰ê·  ìˆ˜ë ¹ì•¡</p>
                  [cite_start]<p className="text-5xl font-bold text-red-600">{avgDiagnosis.toLocaleString()}ë§Œì› [cite: 150]</p>
                </div>
                <div className="text-center">
                  <p className="text-base text-gray-600 mb-2">ì¹˜ë£Œë¹„ í‰ê·  ìˆ˜ë ¹ì•¡</p>
                  [cite_start]<p className="text-5xl font-bold text-blue-600">{avgTreatment.toLocaleString()}ë§Œì› [cite: 157]</p>
                </div>
              </div>
              <p className="text-3xl font-bold text-green-600 text-center">
                [cite_start]ì¹˜ë£Œë¹„ê°€ í‰ê·  {(avgTreatment - avgDiagnosis).toLocaleString()}ë§Œì› ë” ìœ ë¦¬í•©ë‹ˆë‹¤! [cite: 159]
              </p>
            </div>

            {/* ì¬ë°œ ë¦¬ìŠ¤í¬ ë¹„êµ */}
            <div className="bg-red-50 rounded-xl p-8 mb-8 border-l-4 border-red-400">
              <h3 className="text-2xl font-bold mb-6 text-red-800">âš ï¸ ê²°ì •ì  ì°¨ì´: ì¬ë°œ ë¦¬ìŠ¤í¬ ê´€ë¦¬</h3>
              <div className="grid grid-cols-2 gap-8 text-center">
                <div>
                  [cite_start]<p className="text-xl font-bold text-gray-600 mb-3">ì§„ë‹¨ê¸ˆ ìƒí’ˆ (ê³ ìœ„í—˜ ì„ íƒ) [cite: 180]</p>
                  <p className="text-4xl font-bold text-red-600">0ì›</p>
                  [cite_start]<p className="text-base text-gray-700 mt-2">ì¬ë°œ ì‹œ ì¶”ê°€ ì§€ê¸‰ ì—†ìŒ [cite: 113]</p>
                  <p className="text-sm text-gray-500">79%ì— í•´ë‹¹í•˜ë©´ ë³´ì¥ ì†Œì§„</p>
                </div>
                <div>
                  [cite_start]<p className="text-xl font-bold text-gray-600 mb-3">ì¹˜ë£Œë¹„ ìƒí’ˆ (ì €ìœ„í—˜ ì„ íƒ) [cite: 181]</p>
                  <p className="text-4xl font-bold text-blue-600">ê³„ì† ì§€ê¸‰</p>
                  [cite_start]<p className="text-base text-gray-700 mt-2">ì¬ë°œí•´ë„ ì¹˜ë£Œë§ˆë‹¤ ë³´ì¥ [cite: 114]</p>
                  <p className="text-sm text-gray-500">ì¹˜ë£Œê°€ ëë‚  ë•Œê¹Œì§€ ë³´ì¥</p>
                </div>
              </div>
            </div>

            <button
              onClick={() => setStep(6)}
              className="w-full bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-full text-xl font-semibold transition-all transform hover:scale-105 shadow-lg"
            >
              5ë‹¨ê³„: ê³ ê° ìƒë‹´ ë¡¤í”Œë ˆì´ ì²´í—˜í•˜ê¸° <ArrowRight className="inline ml-2" />
            </button>
          </div>
        </div>
      </div>
    );
  };

  // 7. ê³ ê° ìƒë‹´ ë¡¤í”Œë ˆì´
  const renderStep6 = () => {
    const question = consultingQuestions[0];
    const isAnswered = consultingAnswer !== null;
    const selectedAnswerData = isAnswered ? question.answers[consultingAnswer] : null;

    // ë¡¤í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ ì‹œ ë±ƒì§€ íšë“ ë©”ì‹œì§€ ì„¤ì •
    const badgeMessage = isAnswered && selectedAnswerData.score === 100 ? "â­ ìµœìš°ìˆ˜ FP ë°°ì§€ íšë“! ê³ ê°ì„ í•©ë¦¬ì ìœ¼ë¡œ ì„¤ë“í–ˆìŠµë‹ˆë‹¤." : isAnswered ? "ì•„ì‰½ìŠµë‹ˆë‹¤! í•µì‹¬ì„ ë†“ì¹˜ì§€ ì•Šë„ë¡ ë‹¤ì‹œ ë³µìŠµí•´ë³´ì„¸ìš”." : "ë‹µë³€ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.";

    return (
      <div className="min-h-screen bg-gradient-to-br from-orange-50 to-red-100 p-4">
        <div className="max-w-4xl mx-auto py-12">
          <div className="bg-white rounded-3xl shadow-2xl p-12">
            <Users className="w-16 h-16 mx-auto mb-6 text-orange-600" />
            <h2 className="text-4xl font-bold mb-8 text-center text-gray-800">5ë‹¨ê³„: ê³ ê° ìƒë‹´ ë¡¤í”Œë ˆì´</h2>

            <div className="bg-blue-50 rounded-xl p-6 mb-8 border-l-4 border-blue-400">
              <p className="text-xl font-semibold mb-2 text-blue-800">ê³ ê°ì˜ ì§ˆë¬¸</p>
              [cite_start]<p className="text-2xl text-gray-800">"{question.question}" [cite: 5, 6]</p>
            </div>

            <p className="text-center text-xl font-semibold text-gray-600 mb-6">ë‹¹ì‹ ì´ë¼ë©´ ì–´ë–»ê²Œ ì„¤ë“í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>

            <div className="space-y-4 mb-8">
              {question.answers.map((answer, idx) => (
                <button
                  key={idx}
                  onClick={() => setConsultingAnswer(idx)}
                  disabled={isAnswered}
                  className={`w-full text-left p-6 rounded-xl border-2 transition-all ${
                    isAnswered && consultingAnswer === idx
                      ? answer.score === 100
                        ? 'bg-green-50 border-green-400 shadow-md'
                        : answer.score === 50
                          ? 'bg-yellow-50 border-yellow-400 shadow-md'
                          : 'bg-red-50 border-red-400 shadow-md'
                      : 'bg-gray-50 border-gray-300 hover:bg-gray-100'
                  }`}
                >
                  <p className="text-lg">{answer.text}</p>
                  {isAnswered && consultingAnswer === idx && (
                    <div className="mt-4 pt-4 border-t border-gray-300">
                      <p className="text-lg font-semibold text-gray-800 mb-2">{answer.feedback}</p>
                      <div className="w-full bg-gray-200 rounded-full h-3">
                        <div
                          className={`h-3 rounded-full ${answer.score === 100 ? 'bg-green-500' : answer.score === 50 ? 'bg-yellow-500' : 'bg-red-500'}`}
                          style={{ width: `${answer.score}%` }}
                        />
                      </div>
                      <p className="text-sm text-gray-600 mt-1">ì„¤ë“ ì ìˆ˜: {answer.score}ì </p>
                    </div>
                  )}
                </button>
              ))}
            </div>

            <div className="text-center mb-8">
              <p className={`text-2xl font-bold ${selectedAnswerData?.score === 100 ? 'text-green-600' : isAnswered ? 'text-red-600' : 'text-gray-500'}`}>{badgeMessage}</p>
            </div>

            {isAnswered && (
              <button
                onClick={() => setStep(7)}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white px-8 py-4 rounded-full text-xl font-semibold transition-all transform hover:scale-105 shadow-lg"
              >
                ëª¨ë“  í•™ìŠµ ì™„ë£Œ! ìµœì¢… ìš”ì•½ ë³´ê¸°
              </button>
            )}
          </div>
        </div>
      </div>
    );
  };

  // 8. í•™ìŠµ ì™„ë£Œ ë° ìµœì¢… ìš”ì•½
  const renderStep7 = () => (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-blue-100 p-4">
      <div className="max-w-5xl mx-auto py-12">
        <div className="bg-white rounded-3xl shadow-2xl p-12 text-center">
          <Award className="w-24 h-24 mx-auto mb-6 text-indigo-600" />
          <h2 className="text-5xl font-bold mb-8 text-gray-800">í•™ìŠµ ì™„ë£Œ! ì¶•í•˜ë“œë¦½ë‹ˆë‹¤ ğŸ‰</h2>

          <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-8 mb-8 border-l-8 border-green-500">
            <h3 className="text-2xl font-bold mb-4 text-green-800">ìµœì¢… ì„¤ë“ í•µì‹¬ ìš”ì•½</h3>
            <div className="space-y-4 text-left text-lg">
              [cite_start]<p><CheckCircle className="inline w-5 h-5 text-green-600 mr-2" /> **í™•ë¥ :** 21%ì˜ í–‰ìš´ì´ ì•„ë‹Œ **79%ì˜ í˜„ì‹¤**ì— ëŒ€ë¹„í•´ì•¼ í•©ë‹ˆë‹¤. [cite: 186]</p>
              [cite_start]<p><CheckCircle className="inline w-5 h-5 text-green-600 mr-2" /> **ê¸ˆì•¡:** ì¹˜ë£Œë¹„ ìƒí’ˆì´ í‰ê·  **2.27ë°°(4,535ë§Œì›)** ë” í° ê¸°ëŒ€ê°’ì„ ë³´ì¥í•©ë‹ˆë‹¤. [cite: 157, 159]</p>
              [cite_start]<p><CheckCircle className="inline w-5 h-5 text-green-600 mr-2" /> **ë¦¬ìŠ¤í¬:** ì¬ë°œ ì‹œ ì§„ë‹¨ê¸ˆì€ **0ì›**ì´ì§€ë§Œ, ì¹˜ë£Œë¹„ëŠ” **ì¹˜ë£Œê°€ ëë‚  ë•Œê¹Œì§€** ë³´ì¥ë©ë‹ˆë‹¤. [cite: 113, 114, 200]</p>
            </div>
            <p className="text-2xl font-bold mt-6 text-blue-700">
              [cite_start]ğŸ‘‰ ì¹˜ë£Œë¹„ ì¤‘ì‹¬ì˜ ë³´í—˜ì´ í›¨ì”¬ ë” í•©ë¦¬ì ì´ê³  ì•ˆì „í•œ ì„ íƒì…ë‹ˆë‹¤. [cite: 200]
            </p>
          </div>

          <button
            onClick={() => {
              // ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹
              setStep(0);
              setUserPrediction(50);
              setSelectedScenario(null);
              setScenarioProgress(0);
              setConsultingAnswer(null);
            }}
            className="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-4 rounded-full text-xl font-semibold transition-all transform hover:scale-105 shadow-lg flex items-center justify-center"
          >
            <RefreshCw className="mr-3 w-6 h-6" /> ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•™ìŠµí•˜ê¸°
          </button>
        </div>
      </div>
    );
  };

  // ë‹¨ê³„ë³„ ë Œë”ë§ í•¨ìˆ˜ ë°°ì—´
  const steps = [
    renderStep0,
    renderStep1,
    renderStep2,
    renderStep3,
    renderStep4,
    renderStep5,
    renderStep6,
    renderStep7
  ];

  return (
    <div className="font-sans">
      {steps[step]()}

      {/* í•˜ë‹¨ ì§„í–‰ í‘œì‹œì¤„ */}
      {step > 0 && step < 7 && (
        <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-white rounded-full shadow-xl px-6 py-3 border border-gray-200">
          <div className="flex items-center gap-2">
            {[1, 2, 3, 4, 5, 6, 7].map((s) => (
              <div
                key={s}
                className={`w-3 h-3 rounded-full transition-all duration-300 ${s <= step ? 'bg-blue-600 scale-110' : 'bg-gray-300'}`}
              />
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
